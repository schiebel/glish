# $Header$
#
# Autoconf Makefile template for glish clients.

CC = @CC@
CPLUS = @CXX@
INSTALL = @INSTALL@
INSTALL_PROGRAM = @INSTALL_PROGRAM@

MKHIER = @top_srcdir@/config/mkhier

SHELL = /bin/sh

CFLAGS = @GLISH_FLAGS@ @CFLAGS@
CXXFLAGS = @GLISH_FLAGS@ @CXXFLAGS@

SRC = ..
GLISH_SRC = ../..

INSTALLDIR = @top_srcdir@
LIBDIR = $(INSTALLDIR)/lib/$(ARCH)
BINDIR = $(INSTALLDIR)/bin/$(ARCH)
INCDIR = $(INSTALLDIR)/include

##
## prefix may be used as part of '@exec_prefix@'
##
prefix = @prefix@
PFX_INSTALLDIR = @exec_prefix@
PFX_INCDIR = @prefix@/include
PFX_LIBDIR = $(PFX_INSTALLDIR)/lib
PFX_BINDIR = $(PFX_INSTALLDIR)/bin

INCLUDE = -I$(GLISH_SRC)/$(ARCH) -I$(GLISH_SRC) -I$(GLISH_SRC)/include $(PLUSINC)
CINCLUDE = -I$(GLISH_SRC)/$(ARCH) -I$(GLISH_SRC) -I$(GLISH_SRC)/include

SDS_LIB = $(LIBDIR)/libsds.a
NPD_LIB = $(LIBDIR)/libnpd.a
GLISH_LIBS = $(GLISH_SRC)/$(ARCH)/libglish.a $(SDS_LIB) $(NPD_LIB)
LIBS = $(GLISH_LIBS) -lm @LIBS@

CLIENTS = \
	echo_client \
	echo_mclient \
	glishd \
	shell_client \
	tell_glishd \
	test_client \
	timer \
	multiplexer

INSTALLED_CLIENTS = \
	$(BINDIR)/echo_client \
	$(BINDIR)/echo_mclient \
	$(BINDIR)/glishd \
	$(BINDIR)/shell_client \
	$(BINDIR)/tell_glishd \
	$(BINDIR)/test_client \
	$(BINDIR)/timer \
	$(BINDIR)/multiplexer


PFX_INSTALLED_CLIENTS = \
	$(PFX_BINDIR)/echo_client \
	$(PFX_BINDIR)/echo_mclient \
	$(PFX_BINDIR)/glishd \
	$(PFX_BINDIR)/shell_client \
	$(PFX_BINDIR)/tell_glishd \
	$(PFX_BINDIR)/test_client \
	$(PFX_BINDIR)/timer \
	$(PFX_BINDIR)/multiplexer

TAR_FILE = glish-clients.tar

all: $(CLIENTS)

make-dir:
	$(MKHIER) $(BINDIR)

install: make-dir $(INSTALLED_CLIENTS)

prefix-make-dir:
	$(MKHIER) $(PFX_BINDIR)

prefix-install: prefix-make-dir $(PFX_INSTALLED_CLIENTS)

$(GLISH_SRC)/$(ARCH)/libglish.a:
	cd $(GLISH_SRC)/$(ARCH); $(MAKE) $(MFLAGS) libglish.a

glishd.o: $(SRC)/glishd.cc $(GLISH_SRC)/Executable.h \
		$(GLISH_SRC)/include/Glish/Client.h $(GLISH_SRC)/Channel.h \
		$(GLISH_SRC)/ports.h
	$(CPLUS) $(CXXFLAGS) $(INCLUDE) -I$(INCDIR) -c $(SRC)/glishd.cc 

glishd: glishd.o $(GLISH_LIBS)
	$(CPLUS) $(CXXFLAGS) $(INCLUDE) -o glishd glishd.o $(LIBS)

$(BINDIR)/glishd: glishd
	$(INSTALL_PROGRAM) glishd $(BINDIR)
#	strip $(BINDIR)/glishd

$(PFX_BINDIR)/glishd: glishd
	$(INSTALL_PROGRAM) glishd $(PFX_BINDIR)
#	strip $(PFX_BINDIR)/glishd

echo_client.o: $(SRC)/echo_client.cc $(GLISH_SRC)/include/Glish/Client.h
	$(CPLUS) $(CXXFLAGS) $(INCLUDE) -c $(SRC)/echo_client.cc 

echo_client: echo_client.o $(GLISH_LIBS)
	$(CPLUS) $(CXXFLAGS) $(INCLUDE) -o echo_client echo_client.o $(LIBS)

$(BINDIR)/echo_client: echo_client
	$(INSTALL_PROGRAM) echo_client $(BINDIR)
#	strip $(BINDIR)/echo_client

$(PFX_BINDIR)/echo_client: echo_client
	$(INSTALL_PROGRAM) echo_client $(PFX_BINDIR)
#	strip $(PFX_BINDIR)/echo_client

echo_mclient.o: $(SRC)/echo_mclient.cc $(GLISH_SRC)/include/Glish/Client.h
	$(CPLUS) $(CXXFLAGS) $(INCLUDE) -c $(SRC)/echo_mclient.cc 

echo_mclient: echo_mclient.o $(GLISH_LIBS)
	$(CPLUS) $(CXXFLAGS) $(INCLUDE) -o echo_mclient echo_mclient.o $(LIBS)

$(BINDIR)/echo_mclient: echo_mclient
	$(INSTALL_PROGRAM) echo_mclient $(BINDIR)
#	strip $(BINDIR)/echo_mclient

$(PFX_BINDIR)/echo_mclient: echo_mclient
	$(INSTALL_PROGRAM) echo_mclient $(PFX_BINDIR)
#	strip $(PFX_BINDIR)/echo_mclient

shell_client.o: $(SRC)/shell_client.cc $(GLISH_SRC)/include/Glish/Client.h \
		$(GLISH_SRC)/Channel.h
	$(CPLUS) $(CXXFLAGS) $(INCLUDE) -c $(SRC)/shell_client.cc 

shell_client: shell_client.o $(GLISH_LIBS)
	$(CPLUS) $(CXXFLAGS) $(INCLUDE) -o shell_client shell_client.o $(LIBS)

$(BINDIR)/shell_client: shell_client
	$(INSTALL_PROGRAM) shell_client $(BINDIR)
#	strip $(BINDIR)/shell_client

$(PFX_BINDIR)/shell_client: shell_client
	$(INSTALL_PROGRAM) shell_client $(PFX_BINDIR)
#	strip $(PFX_BINDIR)/shell_client

tell_glishd.o: $(SRC)/tell_glishd.cc $(GLISH_SRC)/include/Glish/Client.h  \
		$(GLISH_SRC)/ports.h
	$(CPLUS) $(CXXFLAGS) $(INCLUDE) -I$(INCDIR) -c $(SRC)/tell_glishd.cc 

tell_glishd: tell_glishd.o $(GLISH_LIBS)
	$(CPLUS) $(CXXFLAGS) $(INCLUDE) -o tell_glishd tell_glishd.o $(LIBS)

$(BINDIR)/tell_glishd: tell_glishd
	$(INSTALL_PROGRAM) tell_glishd $(BINDIR)
#	strip $(BINDIR)/tell_glishd

$(PFX_BINDIR)/tell_glishd: tell_glishd
	$(INSTALL_PROGRAM) tell_glishd $(PFX_BINDIR)
#	strip $(BINDIR)/tell_glishd

test_client.o: $(SRC)/test_client.cc $(GLISH_SRC)/include/Glish/Client.h
	$(CPLUS) $(CXXFLAGS) $(INCLUDE) -c $(SRC)/test_client.cc 

test_client: test_client.o $(GLISH_LIBS)
	$(CPLUS) $(CXXFLAGS) $(INCLUDE) -o test_client test_client.o $(LIBS)

$(BINDIR)/test_client: test_client
	$(INSTALL_PROGRAM) test_client $(BINDIR)
#	strip $(BINDIR)/test_client

$(PFX_BINDIR)/test_client: test_client
	$(INSTALL_PROGRAM) test_client $(PFX_BINDIR)
#	strip $(PFX_BINDIR)/test_client

timer.o: $(SRC)/timer.cc $(GLISH_SRC)/include/Glish/Client.h
	$(CPLUS) $(CXXFLAGS) $(INCLUDE) -c $(SRC)/timer.cc 

timer: timer.o $(GLISH_LIBS)
	$(CPLUS) $(CXXFLAGS) $(INCLUDE) -o timer timer.o $(LIBS)

$(BINDIR)/timer: timer
	$(INSTALL_PROGRAM) timer $(BINDIR)
#	strip $(BINDIR)/timer

$(PFX_BINDIR)/timer: timer
	$(INSTALL_PROGRAM) timer $(PFX_BINDIR)
#	strip $(PFX_BINDIR)/timer

multiplexer.o: $(SRC)/multiplexer.cc $(GLISH_SRC)/include/Glish/Client.h
	$(CPLUS) $(CXXFLAGS) $(INCLUDE) -c $(SRC)/multiplexer.cc 

multiplexer: multiplexer.o $(GLISH_LIBS)
	$(CPLUS) $(CXXFLAGS) $(INCLUDE) -o multiplexer multiplexer.o $(LIBS)

$(BINDIR)/multiplexer: multiplexer
	$(INSTALL_PROGRAM) multiplexer $(BINDIR)
#	strip $(BINDIR)/multiplexer

$(PFX_BINDIR)/multiplexer: multiplexer
	$(INSTALL_PROGRAM) multiplexer $(PFX_BINDIR)
#	strip $(PFX_BINDIR)/multiplexer

tar:
	@rm -f $(TAR_FILE).Z tar-files
	@$(MAKE) $(MFLAGS) tar-list >tar-files
	tar cf $(TAR_FILE) -I tar-files
	compress $(TAR_FILE)
	@rm -f tar-files

tar-list:
	@ls Makefile.in *.cc

rcsinfo:
	@echo glish/clients
	@rlog -L -S RCS/*,v

clean:
	@rm -f errs *.o *~* $(APPS) core a.out *.a ../$(TAR_FILE).Z

distclean: clean
	rm -f config.status config.cache config.h Makefile

