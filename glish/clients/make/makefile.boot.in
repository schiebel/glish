# RCSid:
#	$Id$

#
# modify MACHINE and MACHINE_ARCH as appropriate for your target architecture
#
prefix=@prefix@
srcdir=@srcdir@
VPATH=.:$(srcdir)
CC=@CC@
CXX=@CXX@
MACHINE=`$(srcdir)/machine.sh`
MACHINE_ARCH=`$(srcdir)/machine.sh arch`
INSTALL=$(srcdir)/install-sh
MKDEP=$(srcdir)/mkdeps.sh -n -i/usr/include
MKDEP_OPTS=-A
MK=${prefix}/share/mk

CFLAGS=-g -I../../../include -I$(srcdir) @DEFS@ @CPPFLAGS@ -DMAKE_BOOTSTRAP ${XDEFS}
CXXFLAGS=-g -I../../../include -I$(srcdir) @DEFS@ @CPPFLAGS@ -DMAKE_BOOTSTRAP ${XDEFS}
MDEFS="-DFORCE_MACHINE=\"${MACHINE}\"" "-DMACHINE_ARCH=\"${MACHINE_ARCH}\""

OBJ=arch.o buf.o compat.o cond.o dir.o for.o hash.o job.o main.o make.o \
    parse.o str.o suff.o targ.o var.o util.o getopt.o sigcompat.o make_client.o @LIBOBJS@

make_client: ${OBJ}
	(cd lst.lib; $(MAKE) -f makefile.boot CC="$(CC)" CFLAGS="-I.. ${CFLAGS}" )
	${CC} *.o lst.lib/*.o -o make_client @LIBS@

install:
	${INSTALL} -m755 bmake ${prefix}/bin
	test -d ${MK} || ${INSTALL} -m775 -d ${MK}
	${INSTALL} -m644 ${srcdir}/mk/[d-s]*.mk ${MK}
	test -s ${MK}/bsd.own.mk || ${INSTALL} -m644 ${srcdir}/mk/bsd*.mk ${MK}
	test -s ${MK}/sys.mk || ${INSTALL} -m644 ${srcdir}/mk/`uname`.sys.mk ${MK}/sys.mk

depend:
	VPATH=${VPATH} ${MKDEP} $(MKDEP_OPTS) -f makefile.boot ${CFLAGS} ${OBJ:.o=.c}
	(cd lst.lib; $(MAKE) -f makefile.boot depend MKDEP="$(MKDEP) $(MKDEP_OPTS)" CC="$(CC)" CFLAGS="-I.. ${CFLAGS}" )

main.o: $(srcdir)/main.c
	${CC} ${CFLAGS} ${MDEFS} -o $@ -c $(srcdir)/main.c

${OBJ}: config.h

# can't rely on VPATH
#arch.o:	$(srcdir)/arch.c
#buf.o: $(srcdir)/buf.c
#compat.o: $(srcdir)/compat.c
#cond.o: $(srcdir)/cond.c
#dir.o: $(srcdir)/dir.c
#for.o: $(srcdir)/for.c
#hash.o: $(srcdir)/hash.c
#job.o: $(srcdir)/job.c
#main.o: $(srcdir)/main.c
#make.o: $(srcdir)/make.c
#parse.o: $(srcdir)/parse.c
#str.o: $(srcdir)/str.c
#suff.o: $(srcdir)/suff.c
#targ.o: $(srcdir)/targ.c
#var.o: $(srcdir)/var.c
#util.o: $(srcdir)/util.c
