## $Id$
## Copyright (c) 1998 Associated Universities Inc.
##
## Makefile for gtk
##

GLISH_LIB_SUFFIX = @GLISH_LIB_SUFFIX@
TK_LIB = @TK_LIB@
CLIENT_LIBS = @TKCLIENT_LIBS@

CFLAGS = @TK_FLAGS@ @CFLAGS@
CXXFLAGS = @TK_FLAGS@ @CXXFLAGS@
LIB_SUFFIX = @GLISH_LIB_SUFFIX@

SLIB_CFLAGS = @SLIB_CFLAGS@

CC = @CC@
CPLUS = @CXX@
INSTALL = @INSTALL@
INSTALL_PROGRAM = @INSTALL_PROGRAM@
INSTALL_DATA = @INSTALL_DATA@

SHELL = /bin/sh
SH = $(SHELL)

SRC = ..
H = $(SRC)/include/Glish
GLISH_SRC = $(SRC)/../..

top = @top_srcdir@@top_off@
INCDIR_P = $(top)/include
LIBDIR_P = $(top)/lib/$(ARCH)
BINDIR_P = $(top)/bin/$(ARCH)
SCRIPTDIR_P = $(top)/share/glish

prefix = @prefix@
exec_prefix = @exec_prefix@
INCDIR = @includedir@
LIBDIR = @libdir@
BINDIR = @bindir@
SCRIPTDIR = @SCRIPTDIR@

MKHIER = $(top)/config/mkhier


GLISH_LIBS = malloc.o $(LIBDIR_P)/libglish$(LIB_SUFFIX) $(LIBDIR_P)/libsos$(LIB_SUFFIX)
LIBS = $(CLIENT_LIBS) $(TK_LIB) @LIBS@

OBJS = main.o tkProxy.o tkCore.o tkCanvas.o malloc.o

RCDIR = @RCDIR@
TK_LIB = @TK_LIB@ 
DL_LIBS = @DL_LIBS@
XLIB = @XLIBSW@
XINC = @XINCLUDES@

INCLUDE = -I. -I$(SRC)/include -I$(SRC) -I$(GLISH_SRC) -I$(GLISH_SRC)/include -I$(INCDIR_P) @TK_INCL@ $(XINC) $(PLUSINC)
CINCLUDE = -I. -I$(SRC) -I$(SRC)/include -I$(GLISH_SRC) -I$(GLISH_SRC)/include -I$(INCDIR_P) @TK_INCL@ $(XINC)

CLIENTS = $(BINDIR_P)/gtk

INSTALLED_CLIENTS = $(BINDIR)/gtk

SCRIPTS = $(SCRIPTDIR_P)/gtk.g

HEADERS = $(INCDIR_P)/Glish/gtk.h

INSTALLED_SCRIPTS = $(SCRIPTDIR)/gtk.g

TAR_FILE = gtk.tar

all: make-bindir_p make-scriptdir_p make-incdir_p $(CLIENTS) $(SCRIPTS) $(HEADERS)

make-bindir_p:
	$(MKHIER) $(BINDIR_P)

make-bindir:
	$(MKHIER) $(BINDIR)

make-scriptdir_p:
	$(MKHIER) $(SCRIPTDIR_P)

make-scriptdir:
	$(MKHIER) $(SCRIPTDIR)

make-incdir_p:
	$(MKHIER) $(INCDIR_P)

make-incdir:
	$(MKHIER) $(INCDIR)

install:  make-bindir make-scriptdir make-incdir $(INSTALLED_CLIENTS) $(INSTALLED_SCRIPTS)

tkProxy.o: $(SRC)/tkProxy.cc $(H)/gtk.h $(SRC)/comdefs.h
	$(CPLUS) $(INCLUDE) $(CXXFLAGS) $(SLIB_CFLAGS) -c $(SRC)/tkProxy.cc

tkCore.o: $(SRC)/tkCore.cc $(SRC)/tkCore.h $(H)/gtk.h $(SRC)/comdefs.h
	$(CPLUS) $(INCLUDE) $(CXXFLAGS) -c $(SRC)/tkCore.cc

tkCanvas.o: $(SRC)/tkCanvas.cc $(SRC)/tkCanvas.h $(H)/gtk.h $(SRC)/comdefs.h
	$(CPLUS) $(INCLUDE) $(CXXFLAGS) -c $(SRC)/tkCanvas.cc 

malloc.o: $(GLISH_SRC)/malloc.c
	$(CC) $(CINCLUDE) $(CFLAGS) -c $(GLISH_SRC)/malloc.c

main.o: $(SRC)/main.cc $(H)/gtk.h
	$(CPLUS) $(INCLUDE) $(CXXFLAGS) -c $(SRC)/main.cc 

gtk: $(OBJS) $(GLISH_LIBS)
	$(CPLUS) $(INCLUDE) $(CXXFLAGS) -o gtk $(OBJS) $(LIBS) $(XLIB) $(DL_LIBS);

$(BINDIR_P)/gtk: gtk
	$(INSTALL_PROGRAM) gtk $(BINDIR_P)
#	strip $(BINDIR_P)/gtk

$(BINDIR)/gtk: gtk
	$(INSTALL_PROGRAM) gtk $(BINDIR)
#	strip $(BINDIR)/gtk

$(SCRIPTDIR_P)/gtk.g: $(SRC)/gtk.g
	$(INSTALL_DATA) $(SRC)/gtk.g $(SCRIPTDIR_P)

$(SCRIPTDIR)/gtk.g: $(SRC)/gtk.g
	$(INSTALL_DATA) $(SRC)/gtk.g $(SCRIPTDIR)

$(INCDIR_P)/Glish/gtk.h: $(H)/gtk.h
	$(INSTALL_DATA) $(H)/gtk.h $(INCDIR_P)/Glish

tar:
	@rm -f $(TAR_FILE).Z tar-files
	@$(MAKE) $(MFLAGS) tar-list >tar-files
	tar cf $(TAR_FILE) -I tar-files
	compress $(TAR_FILE)
	@rm tar-files

tar-list:
	@echo glish >&2
	@ls Makefile.in config.h.in \
		COPYING glish.init mkinit.sh *.c *.cc *.h *.l *.y \
		*.sed doc/*.ps demos/*.g demos/*.cc demos/*.c \
		demos/README* include/Glish/*.h | grep -v '^config.h$$'
	@cd clients; $(MAKE) $(MFLAGS) tar-list | sed 's,^,clients/,'

rcsinfo:
	@echo glish
	@rlog -L -S RCS/*,v
	@echo glish/include/Glish
	@cd include/Glish; rlog -L -S RCS/*,v
	@cd clients; $(MAKE) $(MFLAGS) rcsinfo

clean:
	@rm -f $(CLIENT_OBJS) $(CLIENT_OBJS_PROXY) $(INTERP_OBJS) $(INTERP_OBJS_PROXY) \
			libglishp$(LIB_SUFFIX) libglish$(LIB_SUFFIX) main.o glish errs \
			parse.cc y.tab.h glish_init.cc scan.cc ../$(TAR_FILE).Z

distclean: clean
	rm -f config.status config.cache config.h config_p.h Makefile

INSTALL_:

